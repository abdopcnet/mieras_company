!function(){"use strict";frappe.provide("erpnext.accounts.dimensions"),erpnext.taxes_and_totals.prototype.is_internal_invoice=function(){return!(!["Sales Invoice","Purchase Invoice"].includes(this.frm.doc.doctype)||!this.frm.doc.is_internal_customer&&!this.frm.doc.is_internal_supplier||this.frm.doc.company!==this.frm.doc.represents_company)},erpnext.taxes_and_totals.prototype.calculate_outstanding_amount=function(t){if(in_list(["Sales Invoice","POS Invoice"],this.frm.doc.doctype)&&this.frm.doc.is_return&&this.calculate_paid_amount(),!(this.frm.doc.is_return||this.frm.doc.docstatus>0||this.is_internal_invoice())&&(frappe.model.round_floats_in(this.frm.doc,["grand_total","total_advance","write_off_amount"]),in_list(["Sales Invoice","POS Invoice","Purchase Invoice"],this.frm.doc.doctype))){var e=this.frm.doc.rounded_total||this.frm.doc.grand_total;if(this.frm.doc.party_account_currency==this.frm.doc.currency)var r=flt(e-this.frm.doc.total_advance-this.frm.doc.write_off_amount,precision("grand_total"));else r=flt(flt(e*this.frm.doc.conversion_rate,precision("grand_total"))-this.frm.doc.total_advance-this.frm.doc.base_write_off_amount,precision("base_grand_total"));if(frappe.model.round_floats_in(this.frm.doc,["paid_amount"]),this.set_in_company_currency(this.frm.doc,["paid_amount"]),this.frm.refresh_field&&(this.frm.refresh_field("paid_amount"),this.frm.refresh_field("base_paid_amount")),in_list(["Sales Invoice","POS Invoice"],this.frm.doc.doctype)){var o=this.frm.doc.redeem_loyalty_points&&this.frm.doc.loyalty_amount?flt(r-this.frm.doc.loyalty_amount,precision("base_grand_total")):r;this.set_default_payment(o,t),this.calculate_paid_amount()}this.calculate_change_amount();var a=this.frm.doc.party_account_currency==this.frm.doc.currency?this.frm.doc.paid_amount:this.frm.doc.base_paid_amount;this.frm.doc.outstanding_amount=flt(r-flt(a)+flt(this.frm.doc.change_amount*this.frm.doc.conversion_rate),precision("outstanding_amount"))}},erpnext.TransactionController.prototype.item_code=function(t,e,r){var o=this,a=frappe.get_doc(e,r),i=0,c=0;if(["Sales Invoice"].includes(this.frm.doc.doctype)?(i=cint(o.frm.doc.update_stock),c=i):("Purchase Receipt"===this.frm.doc.doctype&&o.frm.doc.is_return||"Delivery Note"===this.frm.doc.doctype)&&(c=1),0==this.frm.from_barcode&&(a.barcode=null),this.frm.from_barcode=this.frm.from_barcode-1>=0?this.frm.from_barcode-1:0,a.item_code||a.barcode||a.serial_no){if(this.validate_company_and_party())return this.frm.call({method:"erpnext.stock.get_item_details.get_item_details",child:a,args:{doc:o.frm.doc,args:{item_code:a.item_code,barcode:a.barcode,serial_no:a.serial_no,batch_no:a.batch_no,set_warehouse:o.frm.doc.set_warehouse,warehouse:a.warehouse,customer:o.frm.doc.customer||o.frm.doc.party_name,quotation_to:o.frm.doc.quotation_to,supplier:o.frm.doc.supplier,currency:o.frm.doc.currency,update_stock:i,conversion_rate:o.frm.doc.conversion_rate,price_list:o.frm.doc.selling_price_list||o.frm.doc.buying_price_list,price_list_currency:o.frm.doc.price_list_currency,plc_conversion_rate:o.frm.doc.plc_conversion_rate,company:o.frm.doc.company,order_type:o.frm.doc.order_type,is_pos:cint(o.frm.doc.is_pos),is_return:cint(o.frm.doc.is_return),is_subcontracted:o.frm.doc.is_subcontracted,transaction_date:o.frm.doc.transaction_date||o.frm.doc.posting_date,ignore_pricing_rule:o.frm.doc.ignore_pricing_rule,doctype:o.frm.doc.doctype,name:o.frm.doc.name,project:a.project||o.frm.doc.project,qty:a.qty||1,net_rate:a.rate,stock_qty:a.stock_qty,conversion_factor:a.conversion_factor,weight_per_unit:a.weight_per_unit,weight_uom:a.weight_uom,manufacturer:a.manufacturer,stock_uom:a.stock_uom,pos_profile:cint(o.frm.doc.is_pos)?o.frm.doc.pos_profile:"",cost_center:a.cost_center,tax_category:o.frm.doc.tax_category,item_tax_template:a.item_tax_template,child_docname:a.name}},callback:function(i){i.exc||frappe.run_serially([function(){var t=locals[e][r];o.add_taxes_from_item_tax_template(t.item_tax_rate),t.free_item_data&&o.apply_product_discount(t)},function(){o.frm.doc.is_internal_customer||o.frm.doc.is_internal_supplier?o.get_incoming_rate(a,o.frm.posting_date,o.frm.posting_time,o.frm.doc.doctype,o.frm.doc.company):(a.target_warehouse="",a.from_warehouse="",o.frm.script_manager.trigger("price_list_rate",e,r))},function(){(o.frm.doc.is_internal_customer||o.frm.doc.is_internal_supplier)&&o.calculate_taxes_and_totals()},function(){return o.toggle_conversion_factor(a)},function(){if(c)return frappe.db.get_value("Item",a.item_code,["has_batch_no","has_serial_no"]).then(function(t){t.message&&(t.message.has_batch_no||t.message.has_serial_no)&&(frappe.flags.hide_serial_batch_dialog=!1)})},function(){if(c&&!frappe.flags.hide_serial_batch_dialog)return frappe.db.get_single_value("Stock Settings","disable_serial_no_and_batch_selector").then(function(t){t&&(frappe.flags.hide_serial_batch_dialog=!0)})},function(){if(c&&!frappe.flags.hide_serial_batch_dialog){var t=locals[e][r];$.each(i.message,function(e,r){t[e]||(t[e]=r)}),t.has_batch_no&&t.has_serial_no&&(t.batch_no=void 0),erpnext.show_serial_batch_selector(o.frm,t,function(t){o.frm.script_manager.trigger("qty",t.doctype,t.name),o.frm.doc.set_warehouse||o.frm.script_manager.trigger("warehouse",t.doctype,t.name)},void 0,!frappe.flags.hide_serial_batch_dialog)}},function(){return o.conversion_factor(t,e,r,!0)},function(){return o.remove_pricing_rule(a)},function(){if(a.apply_rule_on_other_items){a.name;o.apply_rule_on_other_items({key:a})}},function(){var t=o.get_company_currency();o.update_item_grid_labels(t)},function(){o.calculate_outstanding_amount(!0)}])}});this.frm.fields_dict.items.grid.grid_rows[a.idx-1].remove()}},erpnext.TransactionController.prototype.qty=function(t,e,r){var o=frappe.get_doc(e,r);this.conversion_factor(t,e,r,!0),this.calculate_stock_uom_rate(t,e,r),this.apply_pricing_rule(o,!0),t.is_pos&&this.set_default_payment()},erpnext.TransactionController.prototype.rate=function(t,e,r){var o=frappe.get_doc(e,r);this.conversion_factor(t,e,r,!0),this.calculate_stock_uom_rate(t,e,r),this.apply_pricing_rule(o,!0),t.is_pos&&this.set_default_payment()}}();
//# sourceMappingURL=fix-selling-controller.min.js.map
